<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Europe Map</title>
    <!-- Include D3.js library -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* Add CSS styling for the map container */
        #map {
            width: 600px;
            height: 600px;
            margin: 0 auto;
            border: 1px solid #aaa;
        }

        #resetButton {
            position: absolute;   /* Position it relative to the nearest positioned ancestor */
            top: 20px;            /* Distance from the top of the ancestor */
            right: 20px;          /* Distance from the right of the ancestor */
            z-index: 10;          /* Higher z-index to ensure it's above the SVG */
            padding: 10px;
            background-color: white;
            border: 1px solid #ccc;
            cursor: pointer;
        }

        body {
				font-family: 'Open Sans', sans-serif;
				font-size: 11px;
				font-weight: 300;
				fill: #242424;
				text-align: center;
				text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
				cursor: default;
			}
			
			.legend {
				font-family: 'Raleway', sans-serif;
				fill: #333333;
			}
			
			.tooltip {
				fill: #333333;
			}

    </style>
</head>
<body>
    <!-- Container for the map -->
    <div>
        <div id="map" class="map-container"></div>
    </div>
    
    <div>
        <button id="resetButton" style="position: absolute; top: 20px; right: 20px; z-index: 10;" onclick="zoomToEurope()">Back to Europe</button>
    </div>

    <div>
        <div>
            <div>
                <div>
                    <input type="text" id="searchInput" placeholder="Search..." onchange="filterDropdownOptions()">
                    <select id="dropdown" multiple></select>
                        <option value="">Select an option</option>
                    </select>
                </div>
            </div>
            <div>
                <div id="selectedPlayersTitle">Selected Players:</div>
                <div id="selectedPlayers"></div>
            </div>
            <div>
                <button onclick="selectPlayer()">Select Player</button>
            </div>
            <div>
                <button onclick="comparePlayer()">Compare Players</button>
            </div>
        </div>

        <script>
            // Fetch data from CSV file
            d3.csv("player_data.csv").then(function(data) {
                // Get the column values
                var columnData = data.map(function(d) {
                    return d.Player;
                });

                // Populate the dropdown options
                var dropdown = document.getElementById("dropdown");
                columnData.forEach(function(value) {
                    var option = document.createElement("option");
                    option.text = value;
                    dropdown.add(option);
                });
            });

            // Filter dropdown options based on search input
            function filterDropdownOptions() {
                var searchInput = document.getElementById("searchInput");
                var filter = searchInput.value.toLowerCase();
                var options = document.getElementById("dropdown").options;

                for (var i = 0; i < options.length; i++) {
                    var option = options[i];
                    var text = option.text.toLowerCase();
                    if (text.includes(filter)) {
                        option.style.display = "";
                    } else {
                        option.style.display = "none";
                    }
                }
            }


            // // Show selected options in the text field
            // var dropdown = document.getElementById("dropdown");
            // dropdown.addEventListener("change", function() {
            //     var selectedPlayers = document.getElementById("selectedPlayers");
            //     selectedPlayers.innerHTML = "";
            //     for (var i = 0; i < dropdown.options.length; i++) {
            //         var option = dropdown.options[i];
            //         if (option.selected) {
            //             var player = document.createElement("div");
            //             player.textContent = option.text;
            //             selectedPlayers.appendChild(player);
            //         }
            //     }
            // });

            // Select player from dropdown and add to text field
            function selectPlayer() {
                var dropdown = document.getElementById("dropdown");
                var selectedPlayers = document.getElementById("selectedPlayers");
                for (var i = 0; i < dropdown.options.length; i++) {
                    var option = dropdown.options[i];
                    if (option.selected) {
                        var player = document.createElement("div");
                        player.textContent = option.text;
                        selectedPlayers.appendChild(player);
                    }
                }
            }

            // Compare selected players with those already added, remove duplicates
            function checkDuplicates() {
                var selectedPlayers = document.getElementById("selectedPlayers");
                var players = selectedPlayers.getElementsByTagName("div");
                var playerNames = [];
                for (var i = 0; i < players.length; i++) {
                    playerNames.push(players[i].textContent);
                }
                return playerNames;
            }

            // Compare selected players on radarplot
            function comparePlayer() {
                var playerNames = checkDuplicates();
                console.log(playerNames)
                if (playerNames.length > 1) {
                    var radarData = [];
                    d3.csv("player_data.csv").then(function(data) {
                        data.forEach(function(d) {
                            if (playerNames.includes(d.Player)) {
                                radarData.push(d);
                            }
                        });
                        console.log(radarData)
                        // createRadarChart(radarData);
                        var radarChartOptions = {
                            w: width,
                            h: height,
                            margin: margin,
                            maxValue: 0.5,
                            levels: 5,
                            roundStrokes: true,
                            color: color
                        };
                        RadarChart(".radarChart", radarData, radarChartOptions);
                    });
                } else {
                    alert("Please select at least two players to compare.");
                }
            }
        </script>
        </div>
        </div>
        <div class="radarChart"></div>
    </div>

    <!-- Include JavaScript file -->
    <script src="map.js"></script>
    <script src="radarChart.js"></script>
</body>
</html>
